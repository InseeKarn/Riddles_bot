name: Daily Bot

on:
  schedule:
    - cron: "0 17 * * *"   # 00:00 ‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ó‡∏¢ (17:00 UTC)
    - cron: "0 23 * * *"   # 06:00 ‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ó‡∏¢ (23:00 UTC)
  workflow_dispatch:      # ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏£‡∏±‡∏ô‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö

jobs:
  run-bot:
    runs-on: ubuntu-latest
    env:
      YT_API: ${{ secrets.YT_API }}
      YT_PRIVACY: ${{ secrets.YT_PRIVACY }}
      YT_CATEGORY: ${{ secrets.YT_CATEGORY }}

      DIS_AUTH: ${{ secrets.DIS_AUTH }}

      UNS_ACCESS: ${{ secrets.UNS_ACCESS }}
      UNS_SECRET: ${{ secrets.UNS_SECRET }}
      UNS_APPID: ${{ secrets.UNS_APPID }}

      PIXA_API: ${{ secrets.PIXA_API }}

      DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
      
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.11"

    - name: Install dependencies
      run: pip install -r requirements.txt

    # ‚úÖ ‡∏î‡∏∂‡∏á state ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏£‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
    - name: Restore state files from previous run
      uses: actions/download-artifact@v4
      with:
        name: state-files
        path: .
      continue-on-error: true

    # ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á credentials.json ‡∏à‡∏≤‡∏Å secret
    - name: Create credentials.json
      run: echo "${{ secrets.YT_CREDENTIALS }}" > credentials.json

    # üîπ ‡∏£‡∏±‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß
    - name: Run script
      run: python main.py

    # ‚úÖ ‡πÄ‡∏ã‡∏ü state ‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏£‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤
    - name: Save updated state files
      uses: actions/upload-artifact@v4
      with:
        name: state-files
        path: |
          downloaded_not_edited.json
          pixabay_blocked.json
          token.json
          pixabay_seen.json

